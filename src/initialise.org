#+Title: Hosting Linux Lab on a single host machine
#+Date: <2017-06-27 Tue>
#+Author: Nikhil Bansal
#+Email: nikhilbansal3456@gmail.com

* Introduction 
  Script to automatically set-up the linux-lab

* Initialisation script

** First line of the script: shebang and the path to interpreter

#+NAME: shebang
#+BEGIN_SRC bash
#!/bin/bash


#+END_SRC

** Function for Adding proxy 
*** First one is for setting proxy in =~/.bashrc= file
*** Second one is for setting proxy for apt : In this first you have to create a file =/etc/apt/apt.conf=

#+NAME: proxy
#+BEGIN_SRC bash
######## Function for setting proxy
function set_proxy()
{
###### Adding proxy in ~/.bashrc file

  LINE='export http_proxy="http://proxy.iiit.ac.in:8080"'
  FILE=~/.bashrc
  grep -qF "$LINE" "$FILE" || echo "$LINE" >> "$FILE" 
  LINE='export https_proxy="http://proxy.iiit.ac.in:8080"'
  FILE=~/.bashrc
  grep -qF "$LINE" "$FILE" || echo "$LINE" >> "$FILE"
  
  export http_proxy="http://proxy.iiit.ac.in:8080"
  export https_proxy="http://proxy.iiit.ac.in:8080"

####### Adding proxy in /etc/apt/apt.conf

  touch /etc/apt/apt.conf
  LINE='Acquire::http::Proxy "http://proxy.iiit.ac.in:8080";'
  FILE=/etc/apt/apt.conf
  grep -qF "$LINE" "$FILE" || echo "$LINE" >> "$FILE"
  
  LINE='Acquire::https::Proxy "http://proxy.iiit.ac.in:8080";'
  FILE=/etc/apt/apt.conf
  grep -qF "$LINE" "$FILE" || echo "$LINE" >> "$FILE"
 
}
#+END_SRC

** The below function is for downloading different packages required for setting Lab on =ubuntu 14.04=
*** Packages required are :-
    
    1. Git : For cloning and other purposes
    2. Php5 
    3. Graphviz
    4. Ldapscripts
    5. Php5-ldap
#+NAME: installPackages
#+BEGIN_SRC bash
function install_packages()
{
 sudo apt-get update -y
 sudo apt-get install git -y
 sudo apt-get install php5 -y
 sudo apt-get install graphviz -y
 sudo apt-get install ldapscripts -y
 sudo apt-get install php5-ldap -y
 sudo apt-get install zenity -y
}

#+END_SRC

** This function is for calling the above function to make changes
#+NAME: callInitialise
#+BEGIN_SRC bash 
set_proxy
install_packages

#+END_SRC 

* Tangle
#+BEGIN_SRC bash :tangle ../scripts/initialise.sh :eval no :noweb yes 
<<imports>>
<<shebang>>
<<proxy>>
<<installPackages>>
<<callInitialise>>
#+END_SRC
